<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì¥í•­ì§€êµ¬ ë§›ì§‘ ê´€ë¦¬ì</title>
<link rel="icon" href="data:,">
<style>
body{font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",sans-serif;margin:0;background:#f6f7f9;}
.wrap{max-width:760px;margin:0 auto;padding:18px;}
.card{background:#fff;border:1px solid #eee;border-radius:16px;padding:16px;box-shadow:0 6px 20px rgba(0,0,0,.06);margin-bottom:12px;}
h1{font-size:18px;margin:0 0 8px;}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
input{padding:10px 12px;border:1px solid #ddd;border-radius:12px;font-size:14px;flex:1;min-width:220px;}
.btn{padding:10px 12px;border:0;border-radius:12px;font-weight:900;cursor:pointer;}
.btn.green{background:#03c75a;color:#fff;}
.btn.dark{background:#111;color:#fff;}
.list{display:flex;flex-direction:column;gap:10px;}
.item{border:1px solid rgba(0,0,0,.08);border-radius:14px;padding:12px;}
.title{font-weight:900;}
.meta{font-size:12px;color:#555;margin-top:4px;line-height:1.35;}
.actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;}
.small{font-size:12px;color:#666;margin-top:6px;}
.pill{display:inline-block;padding:3px 8px;border-radius:999px;background:#f2f2f2;font-size:11px;margin-right:6px;}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>ë§›ì§‘ ì œë³´ ëŒ€ê¸°ëª©ë¡ (ê´€ë¦¬ì)</h1>
    <div class="row">
      <input id="adminKey" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸(adminKey) ì…ë ¥" />
      <button class="btn green" onclick="loadPending()">ëŒ€ê¸°ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°</button>
      <button class="btn dark" onclick="location.href='./'">ì§€ë„ë¡œ</button>
    </div>
    <div class="small">ìŠ¹ì¸ ì‹œ restaurantsë¡œ ë³µì‚¬ë˜ê³ , tierë¥¼ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”. (ì œë³´ë§›ì§‘=reported / ì¸ì¦ë§›ì§‘=verified)</div>
  </div>

  <div class="card">
    <div class="list" id="list"></div>
  </div>
</div>

<script>
const API_URL = "https://twilight-art-ed3c.wlalsqqq.workers.dev";
const listEl = document.getElementById("list");

function esc(s){
  return String(s||"")
    .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#039;");
}

async function loadPending(){
  const adminKey = document.getElementById("adminKey").value.trim();
  if(!adminKey) return alert("adminKeyë¥¼ ì…ë ¥í•´ì¤˜");

  listEl.innerHTML = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦";
  try{
    const res = await fetch(API_URL + "?action=submissions&adminKey=" + encodeURIComponent(adminKey));
    const json = await res.json();
    if(!json.ok) throw new Error(json.error || "load fail");

    const data = json.data || [];
    if(data.length === 0){
      listEl.innerHTML = "<div class='small'>ëŒ€ê¸°ëª©ë¡ì´ ì—†ì–´ìš”.</div>";
      return;
    }

    listEl.innerHTML = "";
    data.forEach(item=>{
      const el = document.createElement("div");
      el.className = "item";
      el.innerHTML = `
        <div class="title">${esc(item.name)} <span class="pill">${esc(item.submissionId)}</span></div>
        <div class="meta">
          ì£¼ì†Œ: ${esc(item.address)}<br/>
          ì¹´í…Œê³ ë¦¬: ${esc(item.category)}<br/>
          íƒœê·¸: ${esc(item.tags)}<br/>
          ì†Œê°œ: ${esc(item.desc)}<br/>
          ë‹‰ë„¤ì„: ${esc(item.nickname)}<br/>
          í”Œë ˆì´ìŠ¤: ${item.placeUrl ? `<a href="${esc(item.placeUrl)}" target="_blank">ì—´ê¸°</a>` : "ì—†ìŒ"}<br/>
          ì‘ì„±: ${esc(item.createdAt)}
        </div>
        <div class="actions">
          <button class="btn green" data-tier="reported">ìŠ¹ì¸(ì œë³´ë§›ì§‘)</button>
          <button class="btn green" data-tier="verified">ìŠ¹ì¸(ğŸ‘‘ ì¸ì¦ë§›ì§‘)</button>
          <button class="btn dark" data-act="reject">ê±°ì ˆ</button>
        </div>
        <div class="small">â€» ìŠ¹ì¸ í›„ lat/lngëŠ” restaurants ì‹œíŠ¸ì—ì„œ ì§ì ‘ ì…ë ¥</div>
      `;

      el.querySelectorAll("button").forEach(btn=>{
        btn.onclick = async ()=>{
          const tier = btn.dataset.tier || "";
          const act = btn.dataset.act || "";
          if (tier) await approve(adminKey, item.submissionId, tier);
          else if (act === "reject") await reject(adminKey, item.submissionId);
        };
      });

      listEl.appendChild(el);
    });

  }catch(e){
    console.error(e);
    listEl.innerHTML = "<div class='small'>ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: " + esc(e.message) + "</div>";
  }
}

async function approve(adminKey, submissionId, tier){
  if(!confirm(`ìŠ¹ì¸í• ê¹Œ?\nsubmissionId=${submissionId}\ntier=${tier}`)) return;

  try{
    const res = await fetch(API_URL, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({
        action:"approve",
        data:{ adminKey, submissionId, tier }
      })
    });
    const json = await res.json();
    if(!json.ok) throw new Error(json.error || "approve fail");
    alert("ìŠ¹ì¸ ì™„ë£Œ!");
    loadPending();
  }catch(e){
    console.error(e);
    alert("ìŠ¹ì¸ ì‹¤íŒ¨: " + (e.message || ""));
  }
}

async function reject(adminKey, submissionId){
  const reason = prompt("ê±°ì ˆ ì‚¬ìœ (ì„ íƒ)") || "";
  try{
    const res = await fetch(API_URL, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({
        action:"reject",
        data:{ adminKey, submissionId, reason }
      })
    });
    const json = await res.json();
    if(!json.ok) throw new Error(json.error || "reject fail");
    alert("ê±°ì ˆ ì²˜ë¦¬ ì™„ë£Œ!");
    loadPending();
  }catch(e){
    console.error(e);
    alert("ê±°ì ˆ ì‹¤íŒ¨: " + (e.message || ""));
  }
}
</script>
</body>
</html>
