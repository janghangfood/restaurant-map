<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì¥í•­ì§€êµ¬ ë§›ì§‘ ì œë³´</title>
<link rel="icon" href="data:,">
<style>
body{font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",sans-serif;margin:0;background:#f6f7f9;}
.wrap{max-width:520px;margin:0 auto;padding:18px;}
.card{background:#fff;border:1px solid #eee;border-radius:16px;padding:16px;box-shadow:0 6px 20px rgba(0,0,0,.06);}
h1{font-size:18px;margin:0 0 6px;}
.sub{font-size:13px;color:#666;margin:0 0 14px;line-height:1.4;}
label{display:block;font-size:13px;color:#333;margin:12px 0 6px;font-weight:900;}
.req{color:#03c75a;font-weight:900;margin-left:4px;}
input, textarea{width:100%;box-sizing:border-box;padding:12px;border:1px solid #ddd;border-radius:12px;font-size:14px;background:#fff;}
textarea{min-height:84px;resize:vertical;}
.chips{display:flex;flex-wrap:wrap;gap:8px;}
.chip{padding:9px 10px;border-radius:999px;border:1px solid #ddd;background:#fff;font-size:13px;user-select:none;font-weight:900;cursor:pointer;}
.chip.active{border-color:#03c75a;background:#03c75a1a;}
.row{display:flex;gap:10px;}
.row > *{flex:1;}
.btn{margin-top:14px;width:100%;padding:14px;border:0;border-radius:14px;background:#03c75a;color:#fff;font-weight:900;font-size:15px;cursor:pointer;}
.btn.secondary{background:#111;}
.btn:disabled{opacity:.6;cursor:not-allowed;}
.small{margin-top:10px;color:#777;font-size:12px;line-height:1.35;}

/* âœ… íŒì—…(ëª¨ë‹¬) */
.modal{
  position:fixed; inset:0;
  background:rgba(0,0,0,.35);
  z-index:10000;
  display:none;
  align-items:center;
  justify-content:center;
  padding:18px;
}
.modal.show{ display:flex; }
.modalCard{
  width:min(360px, 92vw);
  background:#fff;
  border-radius:18px;
  box-shadow:0 16px 40px rgba(0,0,0,.25);
  padding:14px 14px 12px;
  border:1px solid rgba(0,0,0,.06);
}
.modalTitle{ font-weight:900; font-size:14px; color:#111; }
.modalMsg{ margin-top:6px; font-size:12px; color:#444; line-height:1.35; white-space:pre-line; }
.modalBtns{ display:flex; gap:8px; margin-top:12px; }
.mbtn{
  flex:1;
  padding:10px 12px;
  border-radius:12px;
  border:0;
  font-weight:900;
  cursor:pointer;
}
.mbtn.ok{ background:#03c75a; color:#fff; }
.mbtn.dark{ background:#111; color:#fff; }
.mbtn.ghost{ background:#f2f2f2; color:#111; }

/* âœ… ìƒë‹¨ ë¡œë”©ë°” */
.progressTop{
  position:fixed; left:0; top:0; right:0;
  height:3px;
  background:rgba(0,0,0,.06);
  z-index:10001;
  display:none;
}
.progressTop.show{ display:block; }
.progressBar{
  width:35%;
  height:100%;
  background:#03c75a;
  transform: translateX(-120%);
  animation: progressMove 1.0s infinite linear;
}
@keyframes progressMove {
  0% { transform: translateX(-120%); }
  100% { transform: translateX(320%); }
}
</style>
</head>
<body>

<!-- âœ… ë¡œë”©ë°” -->
<div class="progressTop" id="progressTop"><div class="progressBar"></div></div>

<div class="wrap">
  <div class="card">
    <h1>ì¥í•­ì§€êµ¬ ë§›ì§‘ ì œë³´</h1>
    <p class="sub">
      ì œë³´ëœ ë§›ì§‘ì€ ê´€ë¦¬ì í™•ì¸ í›„ ìŠ¹ì¸ë˜ë©´ ì§€ë„ì— í‘œì‹œë¼ìš” ğŸ™‚<br/>
      ê°€ëŠ¥í•˜ë©´ <b>ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ë§í¬</b>ë¥¼ ë„£ì–´ì£¼ë©´ ì¢‹ì•„ìš”.
    </p>

    <label>ê°€ê²Œëª… <span class="req">*</span></label>
    <input id="name" placeholder="ì˜ˆ) ëŒ€ë°•ê°" maxlength="40" />

    <label>ì£¼ì†Œ <span class="req">*</span></label>
    <input id="address" placeholder="ì˜ˆ) ê³ ì–‘ì‹œ ì¼ì‚°ë™êµ¬ ..." maxlength="120" />

    <label>ì¹´í…Œê³ ë¦¬ (ë³µìˆ˜ ì„ íƒ) <span class="req">*</span></label>
    <div id="cats" class="chips"></div>

    <!-- âœ… í•œì¤„ì†Œê°œ í•„ìˆ˜ -->
    <label>í•œì¤„ ì†Œê°œ <span class="req">*</span></label>
    <textarea id="desc" placeholder="ì˜ˆ) ì–‘ ë§ê³  ê°€ì„±ë¹„ ì¢‹ì•„ìš”" maxlength="200"></textarea>

    <label>ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ë§í¬ (ì„ íƒ)</label>
    <input id="placeUrl" placeholder="ì˜ˆ) https://place.map.naver.com/..." maxlength="200" />

    <div class="row">
      <div>
        <label>ë‹‰ë„¤ì„ (ì„ íƒ)</label>
        <input id="nickname" placeholder="ì˜ˆ) ì¥í•­ë§˜" maxlength="20" />
      </div>
      <div>
        <label>ì¶”ì²œ íƒœê·¸(ì„ íƒ)</label>
        <input id="tags" placeholder="ì˜ˆ) ì•„ì´ë™ë°˜,ì£¼ì°¨" maxlength="80" />
      </div>
    </div>

    <button class="btn" id="btnSubmit" type="button">ì œë³´í•˜ê¸°</button>
    <button class="btn secondary" type="button" onclick="goBack()">ì§€ë„ë¡œ ëŒì•„ê°€ê¸°</button>

    <div class="small">
      * í‰ê°€ì—†ì´ ì‘ì„±ëœ ì œë³´ëŠ” ë°˜ë ¤ì²˜ë¦¬ ë©ë‹ˆë‹¤.
    </div>
  </div>
</div>

<!-- âœ… ëª¨ë‹¬ -->
<div class="modal" id="modal">
  <div class="modalCard">
    <div class="modalTitle" id="modalTitle">ì•ˆë‚´</div>
    <div class="modalMsg" id="modalMsg"></div>
    <div class="modalBtns" id="modalBtns"></div>
  </div>
</div>

<script>
const API_URL = "https://twilight-art-ed3c.wlalsqqq.workers.dev";

const CATEGORY_MASTER = ["í•œì‹","ì¤‘ì‹","ì¼ì‹","ì–‘ì‹","ì¹´í˜","ë¶„ì‹","ê³ ê¸°","ë°°ë‹¬","ì¹˜í‚¨","í”¼ì","ë””ì €íŠ¸"];
const selected = new Set();

const catsEl = document.getElementById("cats");
CATEGORY_MASTER.forEach(c=>{
  const el = document.createElement("div");
  el.className = "chip";
  el.textContent = c;
  el.onclick = () => {
    if (selected.has(c)) selected.delete(c);
    else selected.add(c);
    el.classList.toggle("active", selected.has(c));
  };
  catsEl.appendChild(el);
});

/* ===== ëª¨ë‹¬/ë¡œë”© ===== */
const modalEl = document.getElementById("modal");
const modalTitleEl = document.getElementById("modalTitle");
const modalMsgEl = document.getElementById("modalMsg");
const modalBtnsEl = document.getElementById("modalBtns");
const progressTopEl = document.getElementById("progressTop");

function showProgress(on){ progressTopEl.classList.toggle("show", !!on); }

function hideModal(){ modalEl.classList.remove("show"); }
modalEl.addEventListener("click", (e)=>{ if(e.target === modalEl) hideModal(); });

function showModal({ title="ì•ˆë‚´", message="", buttons=[] }){
  modalTitleEl.textContent = title;
  modalMsgEl.textContent = message;
  modalBtnsEl.innerHTML = "";

  const btns = buttons.length ? buttons : [{ text:"í™•ì¸", kind:"ok", onClick: hideModal }];
  btns.forEach(b=>{
    const el = document.createElement("button");
    el.className = "mbtn " + (b.kind || "ok");
    el.textContent = b.text || "í™•ì¸";
    el.onclick = ()=>{ try{ b.onClick && b.onClick(); } finally { if (b.autoClose !== false) hideModal(); } };
    modalBtnsEl.appendChild(el);
  });

  modalEl.classList.add("show");
}

/* ===== ì œì¶œ ===== */
const btnSubmitEl = document.getElementById("btnSubmit");
btnSubmitEl.addEventListener("click", submitRestaurant);

function getVal(id){ return document.getElementById(id).value.trim(); }
function clearForm(){
  document.getElementById("name").value = "";
  document.getElementById("address").value = "";
  document.getElementById("desc").value = "";
  document.getElementById("placeUrl").value = "";
  document.getElementById("nickname").value = "";
  document.getElementById("tags").value = "";
  selected.clear();
  document.querySelectorAll(".chip").forEach(ch => ch.classList.remove("active"));
}

async function submitRestaurant(){
  const name = getVal("name");
  const address = getVal("address");
  const category = [...selected].join(",");

  // âœ… í•œì¤„ì†Œê°œ í•„ìˆ˜
  const desc = getVal("desc");

  const placeUrl = getVal("placeUrl");
  const nickname = getVal("nickname");
  const tags = getVal("tags");

  if(!name) return showModal({ title:"í™•ì¸", message:"ê°€ê²Œëª…ì€ ê¼­ ì…ë ¥í•´ì£¼ì„¸ìš”" });
  if(!address) return showModal({ title:"í™•ì¸", message:"ì£¼ì†ŒëŠ” ê¼­ ì…ë ¥í•´ì£¼ì„¸ìš”" });
  if(selected.size === 0) return showModal({ title:"í™•ì¸", message:"ì¹´í…Œê³ ë¦¬ë¥¼ ìµœì†Œ 1ê°œ ì„ íƒí•´ì£¼ì„¸ìš”" });

  // âœ… í•œì¤„ì†Œê°œ í•„ìˆ˜ ì²´í¬
  if(!desc) return showModal({ title:"í™•ì¸", message:"í•œì¤„ ì†Œê°œëŠ” ê¼­ ì…ë ¥í•´ì¤˜!" });

  // UI ì ê¸ˆ + ë¡œë”©
  btnSubmitEl.disabled = true;
  showProgress(true);

  showModal({
    title: "ë“±ë¡ ìš”ì²­ ì¤‘â€¦",
    message: "ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.",
    buttons: [{ text:"ë‹«ê¸°", kind:"ghost", onClick: hideModal }]
  });

  try{
    const res = await fetch(API_URL, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({
        action:"submit", // (GASê°€ submitRestaurantë§Œ ë°›ìœ¼ë©´ submitRestaurantë¡œ ë°”ê¿”ì¤˜)
        data:{ name, address, category, tags, placeUrl, desc, nickname }
      })
    });

    const json = await res.json();
    if(!json.ok) throw new Error(json.error || "unknown");

    hideModal();
    showModal({
      title:"ë“±ë¡ ì™„ë£Œ",
      message:"ì œë³´ê°€ ì ‘ìˆ˜ëì–´ìš” ğŸ™‚\nê´€ë¦¬ì ìŠ¹ì¸ í›„ ì§€ë„ì— í‘œì‹œë©ë‹ˆë‹¤.",
      buttons: [
        { text:"í™•ì¸", kind:"ok", onClick: hideModal },
        { text:"ì¶”ê°€ ì œë³´", kind:"ghost", onClick: ()=>{ clearForm(); }, autoClose:true }
      ]
    });

    clearForm();
  }catch(e){
    hideModal();
    showModal({
      title:"ë“±ë¡ ì‹¤íŒ¨",
      message:"ì œë³´ ë“±ë¡ì— ì‹¤íŒ¨í–ˆì–´ìš”.\n" + String(e.message || e),
      buttons: [
        { text:"í™•ì¸", kind:"ok", onClick: hideModal }
      ]
    });
  }finally{
    btnSubmitEl.disabled = false;
    showProgress(false);
  }
}

function goBack(){ location.href = "./"; }
</script>
</body>
</html>
