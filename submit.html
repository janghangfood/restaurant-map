<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì¥í•­ì§€êµ¬ ë§›ì§‘ ì œë³´</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",sans-serif;margin:0;background:#f6f7f9;}
    .wrap{max-width:520px;margin:0 auto;padding:18px;}
    .card{background:#fff;border:1px solid #eee;border-radius:16px;padding:16px;box-shadow:0 6px 20px rgba(0,0,0,.06);}
    h1{font-size:18px;margin:0 0 6px;}
    .sub{font-size:13px;color:#666;margin:0 0 14px;line-height:1.4;}
    label{display:block;font-size:13px;color:#333;margin:12px 0 6px;font-weight:800;}
    input, textarea{width:100%;box-sizing:border-box;padding:12px;border:1px solid #ddd;border-radius:12px;font-size:14px;background:#fff;}
    textarea{min-height:84px;resize:vertical;}
    .chips{display:flex;flex-wrap:wrap;gap:8px;}
    .chip{padding:9px 10px;border-radius:999px;border:1px solid #ddd;background:#fff;font-size:13px;user-select:none;cursor:pointer;}
    .chip.active{border-color:#03c75a;background:#03c75a1a;font-weight:900;}
    .row{display:flex;gap:10px;}
    .row > *{flex:1;}
    .btn{margin-top:14px;width:100%;padding:14px;border:0;border-radius:14px;background:#03c75a;color:#fff;font-weight:900;font-size:15px;cursor:pointer;}
    .btn.secondary{background:#f3f4f6;color:#111;}
    .toast{margin-top:12px;padding:12px;border-radius:12px;background:#111;color:#fff;font-size:13px;display:none;}
    .toast.show{display:block;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ì¥í•­ì§€êµ¬ ë§›ì§‘ ì œë³´</h1>
      <p class="sub">ì œë³´ëœ ë§›ì§‘ì€ ê´€ë¦¬ì í™•ì¸ í›„ ìŠ¹ì¸ë˜ë©´ ì§€ë„ì— í‘œì‹œë¼ìš” ğŸ™‚</p>

      <label>ê°€ê²Œëª… *</label>
      <input id="name" placeholder="ì˜ˆ) ì¥í•­ì§¬ë½•" maxlength="40" />

      <label>ì£¼ì†Œ *</label>
      <input id="address" placeholder="ì˜ˆ) ê³ ì–‘ì‹œ ì¼ì‚°ë™êµ¬ ì¥í•­ë™ ..." maxlength="80" />

      <label>ì¹´í…Œê³ ë¦¬(ë³µìˆ˜) *</label>
      <div id="cats" class="chips"></div>

      <label>ì¶”ì²œ íƒœê·¸(ì„ íƒ)</label>
      <input id="tags" placeholder="ì˜ˆ) ì•„ì´ë™ë°˜,ì£¼ì°¨" maxlength="60" />

      <label>ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ë§í¬(ì„ íƒ)</label>
      <input id="placeUrl" placeholder="ì˜ˆ) https://place.map.naver.com/..." maxlength="200" />

      <label>í•œì¤„ ì†Œê°œ(ì„ íƒ)</label>
      <textarea id="desc" placeholder="ì˜ˆ) ì–‘ ë§ê³  ê°€ì„±ë¹„ ì¢‹ì•„ìš”" maxlength="120"></textarea>

      <label>ë‹‰ë„¤ì„(ì„ íƒ)</label>
      <input id="nickname" placeholder="ì˜ˆ) ì¥í•­ë§˜" maxlength="20" />

      <button class="btn" type="button" onclick="submitRestaurant()">ì œë³´í•˜ê¸°</button>
      <button class="btn secondary" type="button" onclick="goBack()">ì§€ë„ë¡œ</button>

      <div id="toast" class="toast"></div>
    </div>
  </div>

<script>
  const API_URL = "https://twilight-art-ed3c.wlalsqqq.workers.dev";

  const CATEGORY_MASTER = ["í•œì‹","ì¤‘ì‹","ì¼ì‹","ì–‘ì‹","ì¹´í˜","ë¶„ì‹","ê³ ê¸°","ë°°ë‹¬","ì¹˜í‚¨","í”¼ì","ë””ì €íŠ¸"];
  const selected = new Set();

  const catsEl = document.getElementById("cats");
  CATEGORY_MASTER.forEach(c=>{
    const el = document.createElement("div");
    el.className = "chip";
    el.textContent = c;
    el.onclick = () => {
      if (selected.has(c)) selected.delete(c);
      else selected.add(c);
      el.classList.toggle("active", selected.has(c));
    };
    catsEl.appendChild(el);
  });

  function toast(msg){
    const t = document.getElementById("toast");
    t.textContent = msg;
    t.classList.add("show");
    setTimeout(()=>t.classList.remove("show"), 2500);
  }

  async function submitRestaurant(){
    const name = document.getElementById("name").value.trim();
    const address = document.getElementById("address").value.trim();
    const category = [...selected].join(",");
    const tags = document.getElementById("tags").value.trim();
    const placeUrl = document.getElementById("placeUrl").value.trim();
    const desc = document.getElementById("desc").value.trim();
    const nickname = document.getElementById("nickname").value.trim();

    if(!name || !address) return toast("ê°€ê²Œëª…/ì£¼ì†ŒëŠ” í•„ìˆ˜!");
    if(!category) return toast("ì¹´í…Œê³ ë¦¬ë¥¼ 1ê°œ ì´ìƒ ì„ íƒ!");

    const payload = {
      action: "submit", // âœ… í•µì‹¬
      data: { name, address, category, tags, placeUrl, desc, nickname }
    };

    try{
      const res = await fetch(API_URL, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(payload)
      });
      const json = await res.json();

      if(!json.ok) return toast("ì œë³´ ì‹¤íŒ¨: " + (json.error || "unknown"));
      toast("ì œë³´ ì™„ë£Œ! (ìŠ¹ì¸ í›„ ì§€ë„ì— í‘œì‹œ)");

    }catch(e){
      console.error(e);
      toast("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜(ì½˜ì†” í™•ì¸)");
    }
  }

  function goBack(){ location.href = "./"; }
</script>
</body>
</html>
